const OpenAI = require("openai");

const openai = new OpenAI({
  baseURL: "https://api.together.xyz/v1", // โ ุงุณุชุจุฏุงู OpenAI ุจู Together.AI
  apiKey: process.env.TOGETHER_AI_API_KEY, // ๐ ุงุณุชุฎุฏู ููุชุงุญ Together.AI
});

// ๐ ุฏุงูุฉ ุชุญููู ุงูุฃุฏุงุก ูุชูุฏูู ุชูุตูุงุช
const analyzePerformance = async (userPerformanceData) => {
  try {
    const prompt = `
    ุฃูุช ูุณุงุนุฏ ุฐูุงุก ุงุตุทูุงุนู ูุชุฎุตุต ูู ุชุญุณูู ุงูุฃุฏุงุก ุงูุดุฎุตู.  
    ุจูุงุกู ุนูู ุงูุจูุงูุงุช ุงูุชุงููุฉ:
    ${JSON.stringify(userPerformanceData)}
    
    **ุงูุชุนูููุงุช:**
    - ูุง ุชุณุชุฎุฏู ุฃุณูุงุก ุงูุญููู ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ.
    - ูุฌุจ ุฃู ุชููู ุงูุชูุตูุงุช ูุงูุนูุฉ ููููุง ููุธุงู ุงูููุงุท ุงูุชุงูู:
      - **๐ ุงูุดุงุฑุฉ ุงูุฐูุจูุฉ:** 70 ููุทุฉ
      - **๐ฅ ุงูุดุงุฑุฉ ุงููุถูุฉ:** 50 - 60 ููุทุฉ
      - **๐ฅ ุงูุดุงุฑุฉ ุงูุจุฑููุฒูุฉ:** 45 - 50 ููุทุฉ
      - **๐ ูุชูุฌุฉ ููุจููุฉ:** 40 - 45 ููุทุฉ
      - **โ ุฃูู ูู 40 ููุทุฉ:** ูุฌุจ ุชูููุฐ ุงูุนููุจุฉ
    
    **ุงููุทููุจ:**
    ูุฏู 3 ุชูุตูุงุช ูุจุงุดุฑุฉ ููุฃุณุจูุน ุงููุงุฏู ุจุฏูู ุฃู ููุฏูุงุช ุฃู ุชุญูููุงุช ุฅุถุงููุฉ.  
    ูุฌุจ ุฃู ุชููู ุงูุชูุตูุงุช:
    1. **ูุญุฏุฏุฉ ููุงุจูุฉ ููุชูููุฐ.**
    2. **ูุจููุฉ ุนูู ุงูุจูุงูุงุช.**
    3. **ุชุญููุฒูุฉ.**
    
    ุงุฎุฑุฌ ุงูุชูุตูุงุช ููุท ููุงุฆูุฉ ูุฑููุฉุ ุฏูู ุฃู ุนุจุงุฑุงุช ุฅุถุงููุฉ.
    `;
    
    const response = await openai.chat.completions.create({
      model: "meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo", // ุงุณุชุฎุฏุงู ูููุฐุฌ Together.AI
      messages: [{ role: "system", content: prompt }],
      temperature: 0.7,
      max_tokens: 300,
    });

    return response.choices[0].message.content;
  } catch (error) {
    console.error("โ ุฎุทุฃ ูู ุชูููุฏ ุงูุชูุตูุงุช:", error.response ? error.response.data : error.message);
    return null;
  }
};

// โ ุฏุงูุฉ ุชูููุฏ ุฑุณุงูุฉ ุชุญููุฒูุฉ ูุฎุตุตุฉ ุจูุงุกู ุนูู ุฃุฏุงุก ุงููุณุชุฎุฏู
const generateMotivationalMessage = async (userPerformanceData) => {
  try {
    const prompt = `
    ๐ฅ **ุชูููุฏ ุฑุณุงูุฉ ุชุญููุฒูุฉ ุฌุงูุฒุฉ** ๐ฅ
  
    **ุงูุชุนูููุงุช ุงููููุฉ ูููููุฐุฌ:**
    - ูุง ุชูู ุจุชุญููู ุงูุจูุงูุงุช ุฃู ุงูุชูููุฑ ุจุตูุช ุนุงูู.
    - ููุท ูู ุจุชูููุฏ ุฑุณุงูุฉ ุชุญููุฒูุฉ ูุจุงุดุฑุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ.
    - ุงุฌุนููุง ูุตูุฑุฉุ ูุงุถุญุฉุ ููุคุซุฑุฉ (ุจูู 2-3 ุฌูู ููุท).
    - ุงุจุฏุฃ ุจูููุฉ ุฅูุฌุงุจูุฉ ูุซู "ุฃุญุณูุช!" ุฃู "ูุง ุดุงุก ุงููู!".
    - ูุง ุชุดุฑุญ ููุงุฐุง ุฃุนุทูุช ูุฐู ุงูุฑุณุงูุฉุ ููุท ุฃุฑุณููุง ูุจุงุดุฑุฉ.
  
    **ุจูุงูุงุช ุงููุณุชุฎุฏู:**
    ${JSON.stringify(userPerformanceData)}
  
    ๐ฏ **ุงูุขูุ ูุฏู ุงูุฑุณุงูุฉ ุงูุชุญููุฒูุฉ ุงูููุงุฆูุฉ ููุทุ ุจุฏูู ุฃู ุชูููุฑ ุฌุงูุจู ุฃู ุชุญููู!**
  `;
  
    const response = await openai.chat.completions.create({
      model: "meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo", // ุงุณุชุฎุฏุงู ูููุฐุฌ Together.AI
      messages: [{ role: "system", content: prompt }],
      temperature: 0.8,
      max_tokens: 150,
    });

    return response.choices[0].message.content;
  } catch (error) {
    console.error("โ ุฎุทุฃ ูู ุชูููุฏ ุงูุฑุณุงูุฉ ุงูุชุญููุฒูุฉ:", error.response ? error.response.data : error.message);
    return null;
  }
};

// ๐บ๏ธ ุฏุงูุฉ ุชูููุฏ ุฎุทุฉ ุฎุทูุฉ ุจุฎุทูุฉ ูุชุญููู ุงููุฏู
const generatePlan = async (userGoal) => {
  try {
    const prompt = `
    ุฃูุช ูุณุงุนุฏ ุฐูุงุก ุงุตุทูุงุนู ูุชุฎุตุต ูู ูุถุน ุฎุทุท ุนูููุฉ ูุชุญููู ุงูุฃูุฏุงู.
    
    **ุงูุชุนูููุงุช:**
    - ูุง ุชูุฏู ููุฏูุงุช ุฃู ุชุญูููุงุช ุฅุถุงููุฉ.
    - ููุท ูู ุจุชูููุฏ ุฎุทุฉ ุฎุทูุฉ ุจุฎุทูุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ.
    - ุงุฌุนู ุงูุฎุทุฉ ูุตูุฑุฉ ููุงุถุญุฉ (4-8 ุฎุทูุงุช ููุท).
    - ุฑูุฒ ุนูู ุฎุทูุงุช ุนูููุฉ ููุงูุนูุฉ ุชูุงุณุจ ุงููุจุชุฏุฆูู.
    - ุชุฃูุฏ ุฃู ูู ุฎุทูุฉ ูู ุฌููุฉ ููุชููุฉ ููุงุถุญุฉ ูุบูููุง.
    - ูุง ุชูุฑุฑ ุงููุฏู ูู ุงูุฎุทุฉุ ููุท ุงุฐูุฑ ุงูุฎุทูุงุช ูุจุงุดุฑุฉ.
    
    **ุงููุฏู:**
    ${userGoal}
    
    **ุงููุทููุจ:**
    ุงุฎุฑุฌ ุงูุฎุทุฉ ููุงุฆูุฉ ูุฑููุฉ (ูุซู: 1. ุงูุฎุทูุฉ ุงูุฃููู. 2. ุงูุฎุทูุฉ ุงูุซุงููุฉ.)ุ ุฏูู ุฃู ุนุจุงุฑุงุช ุฅุถุงููุฉ.
    `;
    
    const response = await openai.chat.completions.create({
      model: "meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo",
      messages: [{ role: "system", content: prompt }],
      temperature: 0.7,
      max_tokens: 300,
    });

    return response.choices[0].message.content;
  } catch (error) {
    console.error("โ ุฎุทุฃ ูู ุชูููุฏ ุงูุฎุทุฉ:", error.response ? error.response.data : error.message);
    return null;
  }
};

module.exports = { analyzePerformance, generateMotivationalMessage, generatePlan };